---
import { getCollection } from 'astro:content';
const allNews = await getCollection('news');
const latest  = allNews.sort((a,b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()).slice(0,3);

const fmt = (d: string) => new Intl.DateTimeFormat('fr-FR', { month: 'long', year: 'numeric' }).format(new Date(d));
---

<!-- Azura "À la une" section: horizontal cards, editorial style -->
<section class="section-py bg-white border-t" style="border-color: var(--border);">
  <div class="max-w-8xl mx-auto px-6 lg:px-10">

    <div class="flex items-end justify-between mb-14 reveal">
      <div>
        <span class="eyebrow">Actualités</span>
        <h2 class="font-display text-4xl md:text-5xl font-semibold text-gray-900 leading-tight">
          À la une
        </h2>
      </div>
      <a href="/news" class="link-arrow hidden md:inline-flex">
        Découvrez nos actualités
        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>

    <!-- Cards — Azura style: image top, date + tag, serif title -->
    <div class="grid md:grid-cols-3 gap-8 stagger">
      {latest.map((post) => (
        <article class="reveal group">
          <!-- Image -->
          <a href={`/news/${post.slug}`} class="block overflow-hidden aspect-[16/10] mb-5">
            <img
              src={post.data.coverImage}
              alt={post.data.title}
              width="600" height="375"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700"
              loading="lazy"
            />
          </a>

          <!-- Meta -->
          <div class="flex items-center gap-3 mb-3">
            <span class="text-xs font-medium uppercase tracking-widest" style="color: var(--text-muted);">
              {fmt(post.data.date)}
            </span>
            <span class="w-px h-3" style="background: var(--border);"></span>
            {post.data.tags[0] && <span class="tag-pill">{post.data.tags[0]}</span>}
          </div>

          <!-- Title -->
          <h3 class="font-display text-xl font-semibold text-gray-900 mb-3 leading-snug group-hover:text-green-DEFAULT transition-colors uppercase" style="font-size:1.05rem; letter-spacing: .01em;">
            <a href={`/news/${post.slug}`}>{post.data.title}</a>
          </h3>

          <!-- Excerpt -->
          <p class="text-gray-500 text-sm leading-relaxed mb-4 line-clamp-2">{post.data.excerpt}</p>

          <a href={`/news/${post.slug}`} class="link-arrow">
            En savoir plus
            <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </a>
        </article>
      ))}
    </div>

    <div class="mt-10 md:hidden reveal">
      <a href="/news" class="link-arrow">
        Toutes les actualités
        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>
  </div>
</section>
