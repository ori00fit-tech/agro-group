---
import { useTranslations, type Locale } from '@/lib/i18n';

interface Props { lang?: Locale; }
const { lang = 'fr' } = Astro.props;
const t = useTranslations(lang);
const otherLang = lang === 'fr' ? 'en' : 'fr';

const nav = [
  {
    label: 'Notre Groupe',
    href: '/about',
    children: [
      { label: 'Ã€ propos', href: '/about' },
      { label: 'Notre histoire', href: '/about#histoire' },
    ],
  },
  {
    label: 'Nos ActivitÃ©s',
    href: '/activities',
    children: [
      { label: 'Tomates & LÃ©gumes',    href: '/activities/tomates-legumes' },
      { label: 'Herbes Aromatiques',   href: '/activities/herbes-aromatiques' },
      { label: 'Aquaculture',          href: '/activities/aquaculture' },
      { label: 'Logistique',           href: '/activities/logistique-transport' },
      { label: 'Recherche & DÃ©veloppement', href: '/activities/recherche-developpement' },
    ],
  },
  { label: 'Nos Engagements RSE', href: '/commitments' },
  { label: 'ActualitÃ©s',          href: '/news' },
];
---

<header id="site-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-500">
  <!-- Top utility bar -->
  <div id="top-bar" class="hidden lg:block border-b border-white/10 transition-all duration-500">
    <div class="max-w-8xl mx-auto px-6 lg:px-10 flex items-center justify-end gap-6 h-10">
      <a href="/careers" class="text-white/70 hover:text-white text-xs tracking-widest uppercase transition-colors">
        Nous rejoindre
      </a>
      <span class="w-px h-3 bg-white/20"></span>
      <a href="/contact" class="text-white/70 hover:text-white text-xs tracking-widest uppercase transition-colors">
        Nous contacter
      </a>
      <span class="w-px h-3 bg-white/20"></span>
      <a href="#" class="text-white/70 hover:text-white text-xs tracking-widest uppercase transition-colors flex items-center gap-1">
        <span class="text-[10px]">ðŸ‡«ðŸ‡·</span> FR
      </a>
      <a href="#" class="text-white/50 hover:text-white text-xs tracking-widest uppercase transition-colors flex items-center gap-1">
        <span class="text-[10px]">ðŸ‡¬ðŸ‡§</span> EN
      </a>
    </div>
  </div>

  <!-- Main nav -->
  <div class="main-nav-bg transition-all duration-500">
    <div class="max-w-8xl mx-auto px-6 lg:px-10">
      <div class="flex items-center justify-between h-20 lg:h-24">

        <!-- Logo -->
        <a href="/" class="flex items-center gap-3 group flex-shrink-0" aria-label="Agro Group">
          <div class="w-9 h-9 bg-green-DEFAULT flex items-center justify-center transition-transform group-hover:scale-105">
            <svg viewBox="0 0 36 36" fill="none" class="w-6 h-6">
              <path d="M18 3C18 3 7 11 7 20C7 26.6 12 31 18 31C24 31 29 26.6 29 20C29 11 18 3 18 3Z" fill="white"/>
              <path d="M18 13L18 27M12 19L24 19" stroke="#2d6a3f" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="leading-none">
            <span id="logo-text" class="font-display text-2xl font-semibold text-white transition-colors duration-500 tracking-tight">
              Agro<span class="font-light opacity-80">Group</span>
            </span>
          </div>
        </a>

        <!-- Desktop nav -->
        <nav class="hidden lg:flex items-center gap-0" aria-label="Navigation principale">
          {nav.map((item) => (
            <div class="relative group/nav">
              <a
                href={item.href}
                class="nav-link flex items-center gap-1 px-5 py-3 text-sm font-medium text-white/85 hover:text-white transition-colors duration-200 tracking-wide whitespace-nowrap"
              >
                {item.label}
                {item.children && (
                  <svg class="w-3 h-3 transition-transform duration-200 group-hover/nav:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 9l-7 7-7-7"/>
                  </svg>
                )}
              </a>

              {item.children && (
                <div class="absolute top-full left-0 pt-1 opacity-0 invisible group-hover/nav:opacity-100 group-hover/nav:visible transition-all duration-200 pointer-events-none group-hover/nav:pointer-events-auto">
                  <div class="bg-white shadow-xl border border-gray-100 min-w-[220px] py-2">
                    {item.children.map((child) => (
                      <a
                        href={child.href}
                        class="block px-6 py-3 text-sm text-gray-700 hover:text-green-DEFAULT hover:bg-green-light/50 transition-colors duration-150 tracking-wide"
                      >
                        {child.label}
                      </a>
                    ))}
                  </div>
                </div>
              )}
            </div>
          ))}
        </nav>

        <!-- Mobile hamburger -->
        <button
          id="mobile-btn"
          class="lg:hidden p-2 text-white"
          aria-label="Menu"
          aria-expanded="false"
        >
          <svg id="icon-open" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <svg id="icon-close" class="w-6 h-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="hidden lg:hidden bg-white border-t border-gray-100 shadow-xl">
    <nav class="max-w-8xl mx-auto px-6 py-4">
      {nav.map((item) => (
        <div class="border-b border-gray-50 last:border-0">
          <a href={item.href} class="block py-4 font-display text-lg font-medium text-gray-900 hover:text-green-DEFAULT transition-colors">
            {item.label}
          </a>
          {item.children && (
            <div class="pl-4 pb-3 space-y-2">
              {item.children.map((child) => (
                <a href={child.href} class="block py-1.5 text-sm text-gray-600 hover:text-green-DEFAULT transition-colors">
                  {child.label}
                </a>
              ))}
            </div>
          )}
        </div>
      ))}
      <div class="pt-4 flex gap-4">
        <a href="/careers" class="text-xs font-semibold uppercase tracking-widest text-green-DEFAULT">Nous rejoindre</a>
        <a href="/contact" class="text-xs font-semibold uppercase tracking-widest text-green-DEFAULT">Nous contacter</a>
      </div>
    </nav>
  </div>
</header>

<style>
  /* Scrolled state */
  #site-header.scrolled #top-bar { display: none; }
  #site-header.scrolled .main-nav-bg {
    background: white;
    box-shadow: 0 1px 20px rgba(0,0,0,.08);
  }
  #site-header.scrolled .nav-link { color: #1a1a1a; }
  #site-header.scrolled .nav-link:hover { color: #2d6a3f; }
  #site-header.scrolled #logo-text { color: #1a1a1a; }
  #site-header.scrolled #logo-text span { opacity: .65; }

  /* Transparent on top */
  #site-header:not(.scrolled) .main-nav-bg { background: transparent; }
</style>

<script>
  const header  = document.getElementById('site-header')!;
  const mobileBtn  = document.getElementById('mobile-btn')!;
  const mobileMenu = document.getElementById('mobile-menu')!;
  const iconOpen   = document.getElementById('icon-open')!;
  const iconClose  = document.getElementById('icon-close')!;

  const onScroll = () => {
    header.classList.toggle('scrolled', window.scrollY > 40);
  };
  window.addEventListener('scroll', onScroll, { passive: true });
  onScroll();

  mobileBtn.addEventListener('click', () => {
    const open = mobileMenu.classList.toggle('hidden');
    mobileBtn.setAttribute('aria-expanded', String(!open));
    iconOpen.classList.toggle('hidden');
    iconClose.classList.toggle('hidden');
    document.body.style.overflow = open ? '' : 'hidden';
  });
</script>
